#!/usr/bin/env bash
# This script configures a new Ubuntu machine to install Nginx and add a custom X-Served-By header

# Update package index
sudo apt-get update -y

# Install Nginx
sudo apt-get install -y nginx

# Ensure Nginx starts on boot
sudo systemctl enable nginx
sudo systemctl start nginx

# Get the hostname
HOSTNAME=$(hostname)

# Add custom header to default Nginx server block
NGINX_CONF="/etc/nginx/sites-available/default"

sudo sed -i '/server_name _;/a \\tadd_header X-Served-By '"$HOSTNAME"';' "$NGINX_CONF"

# Test Nginx configuration and reload
sudo nginx -t
sudo systemctl reload nginx
