#!/usr/bin/env bash
# This script installs Nginx and configures the X-Served-By header with the server hostname

set -e

# Update package index
apt-get update -y

# Install nginx if not already installed
apt-get install -y nginx

NGINX_CONF="/etc/nginx/sites-available/default"

# Only add header if not present
if ! grep -q "add_header X-Served-By" "$NGINX_CONF"; then
	    # Use double quotes in sed for variable expansion compliance with ShellCheck
	        sed -i "/listen 80 default_server;/a \    add_header X-Served-By \$hostname;" "$NGINX_CONF"
fi

# Test nginx config
nginx -t

# Restart nginx
service nginx restart
